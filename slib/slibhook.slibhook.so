module slibhook

// ๐ฏ ุชุชุจุน ุงุณุชุฏุนุงุก ุฏูุงู ูุญุฏุฏุฉ
method trace(string funcName) {
  print("๐ ุชุชุจุน ุฏุงูุฉ: " + funcName);
  shell.exec("strace -e call=" + funcName + " ./app.exe");
}

// ๐ง ุญูู ูููู ูู ุฏุงูุฉ ุฃู ููุชุจุฉ
method inject(string targetFunc, string replacementCode) {
  print("๐งท Inject: " + targetFunc);
  system.write("hooks/" + targetFunc + ".hook", replacementCode);
}

// ๐ฆ ุชุญููู ููุชุจุฉ ุฎุงุฑุฌูุฉ (.so / .dll)
method analyzeLib(string libPath) {
  string info = shell.exec("nm -D " + libPath + " | grep ' T '");
  return info.split("\n");
}

// ๐ง ุชุญููู ELF Headers (Linux)
method analyzeELF(string path) {
  string headers = shell.exec("readelf -h " + path);
  return headers;
}

// ๐ก๏ธ ูุฑุงูุจุฉ ููู ุฃุซูุงุก ุงูุชุดุบูู
method monitorFile(string path) {
  shell.exec("inotifywait -m " + path + " > log/hook_watch.log");
  return "๐ฅ ุงููุฑุงูุจุฉ ุจุฏุฃุช";
}

// ๐ฅ ุชุณุฌูู ุงุณุชุฏุนุงุกุงุช ุฅูู ููู
method logCall(string funcName) {
  system.write("logs/" + funcName + ".log", "๐ ุชู ุงุณุชุฏุนุงุก: " + funcName + " @ " + system.time());
}

// ๐ ูุฑุงูุจุฉ ููู ููุชุจุฉ ุนูุฏ ุงูุชุนุฏูู
method watchLibrary(string lib) {
  print("๐ ูุฑุงูุจุฉ ุงูููุชุจุฉ: " + lib);
  shell.exec("watch -n 1 ls -l " + lib);
}

// ๐ ุชุญููู ูุงุฌูุงุช ุงูููุชุจุฉ ุงูุฎุงุฑุฌูุฉ
method extractSymbols(string libPath) {
  return shell.exec("objdump -t " + libPath + " | grep FUNC").split("\n");
}

// ๐งช ุงุฎุชุจุงุฑ ูููู ุณุฑูุน ุนูู ุฏุงูุฉ ููููุฉ
method testHook() {
  inject("processData", "override processData() { print('๐ ุชู ุญูู ุงูุฏุงูุฉ'); }");
  logCall("processData");
}
