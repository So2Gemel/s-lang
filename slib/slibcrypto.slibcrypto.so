module slibcrypto

// ğŸ” ØªØ´ÙÙŠØ± XOR Ø¨Ø³ÙŠØ·
method xor(string txt, string key) {
  string out = "";
  for (int i = 0; i < txt.length(); i++) {
    out += chr(ord(txt[i]) ^ ord(key[i % key.length()]));
  }
  return out;
}

// ğŸ” ØªØ´ÙÙŠØ± XOR + HEX
method xorHex(string txt, string key) {
  string xored = xor(txt, key);
  string hex = "";
  foreach (c in xored) {
    hex += hexcode(ord(c));
  }
  return hex;
}

// ğŸ” ØªØ´ÙÙŠØ± XOR + Base64
method xorBase64(string txt, string key) {
  string xored = xor(txt, key);
  return base64.encode(xored);
}

// ğŸ§¬ ØªÙˆÙ„ÙŠØ¯ Ù…ÙØªØ§Ø­ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠ
method generateKey(int length = 16) {
  string charset = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%";
  string key = "";
  for (int i = 0; i < length; i++) {
    int index = shell.exec("echo $RANDOM") % charset.length();
    key += charset[index];
  }
  return key;
}

// ğŸ§¾ ØªÙˆÙ‚ÙŠØ¹ Ø±Ù‚Ù…ÙŠ Ù…Ø¨Ø³Ù‘Ø·
method sign(string data, string key) {
  return xorHex(data, key).substr(0, 32);
}

method verifySign(string data, string key, string signature) {
  return sign(data, key) == signature;
}

// ğŸ” ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰
method hash(string txt) => system.hash(txt);

method checksum(string txt) {
  int sum = 0;
  foreach (c in txt) sum += ord(c);
  return sum;
}

method fileSignature(string path, string key) {
  string content = system.read(path);
  return sign(content, key);
}

method compareFiles(string a, string b) {
  return system.hash(system.read(a)) == system.hash(system.read(b));
}

// ğŸ” ØªØ´ÙÙŠØ± Ù…Ù„Ù Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
method encryptFile(string path, string key) {
  string data = system.read(path);
  string enc = xorBase64(data, key);
  system.write(path + ".enc", enc);
}

method decryptFile(string encPath, string key) {
  string enc = system.read(encPath);
  string data = base64.decode(enc);
  string out = xor(data, key);
  system.write(encPath.replace(".enc", ".dec"), out);
}

// ğŸ›¡ï¸ Ø§Ø®ØªØ¨Ø§Ø± Ù…ÙØªØ§Ø­ ÙØ¹Ù‘Ø§Ù„
method isWeakKey(string key) {
  return key.length() < 6 || key == "123456" || key == "password";
}
